/*! GatherContent Importer - v3.0.0 - 2016-07-13 | http://www.gathercontent.com | Copyright (c) 2016 GatherContent | Licensed GPLv2 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=Backbone.Collection.extend({getById:function(a){return this.find(function(b){var c=b.get("id");return c===a||c&&a&&c==a})}})},{}],2:[function(a,b,c){"use strict";b.exports=function(a){return a.collections.base.extend({model:a.models.item,totalChecked:0,allChecked:!1,syncEnabled:!1,initialize:function(){this.listenTo(this,"checkAll",this.toggleChecked),this.listenTo(this,"change:checked",this.checkChecked)},checkChecked:function(a){var b=!1;a.changed.checked?this.totalChecked++:(this.totalChecked===this.length&&(this.allChecked=!1,b=!0),this.totalChecked--);var c=this.syncEnabled;this.syncEnabled=this.totalChecked>0,c!==this.syncEnabled&&this.trigger("enabledChange",this.syncEnabled),this.totalChecked<this.length&&this.trigger("notAllChecked",!1)},toggleChecked:function(a){this.allChecked=a,this.each(function(b){b.set("checked",!!a)}),this.trigger("render")}})}},{}],3:[function(a,b,c){"use strict";b.exports=function(a){return a.collections.base.extend({model:a.models.navItem,initialize:function(){this.listenTo(this,"activate",this.activate)},getActive:function(){return this.find(function(a){return!a.get("hidden")})},activate:function(a){this.each(function(a){a.set("hidden",!0)}),this.getById(a).set("hidden",!1),this.trigger("render")}})}},{}],4:[function(a,b,c){"use strict";b.exports=function(b){var c=a("./../collections/items.js")(b);return c.extend({model:b.models.post,initialize:function(){c.prototype.initialize.call(this),this.listenTo(this,"updateItems",this.updateItems)},updateItems:function(a){this.each(function(b){var c=b.get("id");c in a&&(a[c].status&&b.set("status",a[c].status),a[c].itemName&&b.set("itemName",a[c].itemName),a[c].updated&&b.set("updated",a[c].updated))})}})}},{"./../collections/items.js":2}],5:[function(a,b,c){"use strict";window.GatherContent=window.GatherContent||{},function(b,c,d,e,f){e.general=e.general||{};var g=e.general;a("./initiate-objects.js")(g),g.models.post=a("./models/post.js")(e),g.collections.posts=a("./collections/posts.js")(g),g.views.postRow=a("./views/post-row.js")(g,e),g.views.statusSelect2=a("./views/status-select2.js")(g),g.views.postRows=a("./views/post-rows.js")(g,e,d),g.models.navItem=a("./models/modal-nav-item.js")(g),g.collections.navItems=a("./collections/modal-nav-items.js")(g),g.views.modalPostRow=a("./views/modal-post-row.js")(g,e),g.views.modal=a("./views/modal.js")(g,e,d),g.monkeyPatchQuickEdit=function(a){var c=b.inlineEditPost.edit;b.inlineEditPost.edit=function(){c.apply(this,arguments),a.apply(this,arguments)}},g.triggerModal=function(a){a.preventDefault();var b=g.getChecked();b.length&&g.modalView===f&&(g.modalView=new g.views.modal({collection:g.generalView.collection}),g.modalView.selected=b,g.modalView.render())},g.getChecked=function(){return d('tbody th.check-column input[type="checkbox"]:checked').map(function(){return parseInt(d(this).val(),10)}).get()},g.init=function(){d(c.body).addClass("gathercontent-admin-select2").on("click","#gc-sync-modal",g.triggerModal),g.generalView=new g.views.postRows({collection:new g.collections.posts(e._posts)}),g.monkeyPatchQuickEdit(function(){g.generalView.trigger("quickEdit",arguments,this)})},d(g.init)}(window,document,jQuery,window.GatherContent)},{"./collections/modal-nav-items.js":3,"./collections/posts.js":4,"./initiate-objects.js":6,"./models/modal-nav-item.js":9,"./models/post.js":10,"./views/modal-post-row.js":13,"./views/modal.js":14,"./views/post-row.js":15,"./views/post-rows.js":16,"./views/status-select2.js":17}],6:[function(a,b,c){"use strict";b.exports=function(b){b.models={base:a("./models/base.js")},b.collections={base:a("./collections/base.js")},b.views={base:a("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":8,"./views/base.js":11}],7:[function(a,b,c){"use strict";b.exports=function(a,b){return b=jQuery.extend({},{action:"gc_sync_items",data:"",percent:0,nonce:"",id:"",stopSync:!0,flush_cache:!1},b),a.models.base.extend({defaults:b,initialize:function(){this.listenTo(this,"send",this.send)},reset:function(){return this.clear().set(this.defaults),this},send:function(a,b,c,d){return c&&this.set("percent",c),jQuery.post(window.ajaxurl,{action:this.get("action"),percent:this.get("percent"),nonce:this.get("nonce"),id:this.get("id"),data:a,flush_cache:this.get("flush_cache")},function(c){return this.trigger("response",c,a),c.success?b(c):d?d(c):void 0}.bind(this)),this}})}},{}],8:[function(a,b,c){"use strict";b.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],9:[function(a,b,c){"use strict";b.exports=function(a){return a.models.base.extend({defaults:{label:"",id:"",hidden:!0,rendered:!1}})}},{}],10:[function(a,b,c){"use strict";b.exports=function(a){return Backbone.Model.extend({defaults:{id:0,item:0,itemName:0,updated:"",current:!0,editLink:"",mapping:0,mappingName:0,mappingLink:"",mappingStatus:"",mappingStatusId:"",status:{},checked:!1,disabled:!1,statuses:[],statusesChecked:!1,statusSetting:{}},url:function b(){var b=window.ajaxurl+"?action=gc_fetch_js_post&id="+this.get("id");return this.get("uncached")&&(this.set("uncached",!1),b+="&flush_cache=force"),b},_get:function(b,c){switch(c){case"disabled":b=!this.get("item")||!this.get("mapping");break;case"mappingStatus":b=a._statuses[b]?a._statuses[b]:"";break;case"mappingStatusId":b=Backbone.Model.prototype.get.call(this,"mappingStatus")}return b},get:function(a){return this._get(Backbone.Model.prototype.get.call(this,a),a)},toJSON:function(){return _.mapObject(Backbone.Model.prototype.toJSON.call(this),_.bind(this._get,this))}})}},{}],11:[function(a,b,c){"use strict";b.exports=Backbone.View.extend({toggleExpanded:function(a){this.model.set("expanded",!this.model.get("expanded"))},getRenderedModels:function(a,b){b=b||this.collection;var c=document.createDocumentFragment();return b.each(function(b){var d=new a({model:b}).render();c.appendChild(d.el)}),c},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}})},{}],12:[function(a,b,c){"use strict";b.exports=function(a){return a.views.base.extend({template:wp.template("gc-item"),tagName:"tr",className:"gc-item",id:function(){return this.model.get("id")},events:{"change .check-column input":"toggleCheck","click .gc-reveal-items":"toggleExpanded"},initialize:function(){this.listenTo(this.model,"change:checked",this.render)},toggleCheck:function(){this.model.set("checked",!this.model.get("checked"))}})}},{}],13:[function(a,b,c){"use strict";b.exports=function(b,c){var d=a("./../views/item.js")(b);return d.extend({template:wp.template("gc-item"),id:function(){return"gc-modal-post-"+this.model.get("id")},className:function(){return"gc-item "+(this.model.get("disabled")?"gc-disabled":"")},events:{"change .check-column input":"toggleCheck","click .gc-status-column":"toggleCheckAndRender"},initialize:function(){this.listenTo(this.model,"change:post_title",this.renderTitle),this.listenTo(this.model,"change:mappingStatus",this.render),this.listenTo(this.model,"render",this.render)},renderTitle:function(){var a=this.model.get("post_title"),b=this.model.get("id");c.$id("post-"+b).find(".column-title .row-title").text(a),c.$id("edit-"+b).find('[name="post_title"]').text(a),c.$id("inline_"+b).find(".post_title").text(a)},toggleCheckAndRender:function(a){this.toggleCheck(),this.render()}})}},{"./../views/item.js":12}],14:[function(a,b,c){"use strict";b.exports=function(b,c,d){b.modalView=void 0;var e;return b.views.base.extend({id:"gc-bb-modal-dialog",template:wp.template("gc-modal-window"),navSeparator:'<li class="separator">&nbsp;</li>',backdrop:'<div class="gc-bb-modal-backdrop">&nbsp;</div>',selected:[],navItems:{},btns:{},currID:"",currNav:!1,timeoutID:null,ajax:null,events:{"click .gc-bb-modal-close":"closeModal","click #btn-cancel":"closeModal","click #gc-btn-ok":"saveModal","click .gc-bb-modal-nav-tabs a":"clickSelectTab","change .gc-field-th.check-column input":"checkAll","click #gc-btn-pull":"startPull","click #gc-btn-push":"startPush"},initialize:function(){e=this,_.bindAll(this,"render","preserveFocus","closeModal","saveModal"),this.setupAjax(),this.navItems=new b.collections.navItems(c._nav_items),this.btns=new b.collections.base(c._modal_btns),this.currNav=this.navItems.getActive(),this.listenTo(this.navItems,"render",this.render),this.listenTo(this.collection,"render",this.render),this.listenTo(this.collection,"enabledChange",this.checkEnableButton),this.listenTo(this.collection,"notAllChecked",this.allCheckedStatus),this.listenTo(this.collection,"updateItems",this.render)},setupAjax:function(){var d=a("./../models/ajax.js")(b,{action:"gc_pull_items",nonce:c._edit_nonce,flush_cache:!!c.queryargs.flush_cache});this.ajax=new d},render:function(){this.$el.attr("tabindex","0").html(this.template({btns:this.btns.toJSON(),navItems:this.navItems.toJSON(),currID:this.currNav?this.currNav.get("id"):""})).append(this.backdrop),this.$el.find("tbody").html(this.getRenderedSelected()),this.buttonStatus(this.collection.syncEnabled),this.allCheckedStatus(this.collection.allChecked),d(document).on("focusin",this.preserveFocus),d(document.body).addClass("gc-modal-open").append(this.$el),this.$el.focus()},getSelected:function(){return this.collection.filter(function(a){return-1!==_.indexOf(e.selected,a.get("id"))&&!a.get("disabled")})},getRenderedSelected:function(){var a=this.getSelected(),c=document.createDocumentFragment();return _.each(a,function(a){var d=new b.views.modalPostRow({model:a}).render();c.appendChild(d.el)}),c},preserveFocus:function(a){this.$el[0]===a.target||this.$el.has(a.target).length||this.$el.focus()},closeModal:function(a){a.preventDefault(),this.undelegateEvents(),d(document).off("focusin"),d(document.body).removeClass("gc-modal-open"),this.remove(),c.$id("bulk-edit").find("button.cancel").trigger("click"),b.modalView=void 0},saveModal:function(a){this.closeModal(a)},clickSelectTab:function(a){a.preventDefault(),this.selectTab(d(a.target).data("id"))},selectTab:function(a){this.currID=a,this.currNav=this.navItems.getById(a),this.navItems.trigger("activate",a)},checkEnableButton:function(a){this.buttonStatus(a)},buttonStatus:function(a){this.$(".media-toolbar button").prop("disabled",!a)},allCheckedStatus:function(a){this.$(".gc-field-th.check-column input").prop("checked",a)},checkAll:function(a){this.collection.trigger("checkAll",d(a.target).is(":checked"))},startPull:function(a){a.preventDefault();var b=this.modelsToJSON(this.setSelectedMappingStatus("starting"));console.warn("pull selected",b),this.doAjax(b,"pull")},startPush:function(a){a.preventDefault();var b=this.modelsToJSON(this.setSelectedMappingStatus("starting"));console.warn("push selected",b),this.doAjax(b,"push")},getSelectedAndChecked:function(){var a=_.filter(this.getSelected(),function(a){return a.get("checked")});return a},modelsToJSON:function(a){return _.map(a,function(a){return a.toJSON()})},ajaxSuccess:function(a){if(console.log("ajaxSuccess response.data",a.data),!a.data.mappings)return this.ajaxFail();var b=[];return _.each(this.getSelectedAndChecked(),function(c){a.data.mappings.length&&-1!==_.indexOf(a.data.mappings,c.get("mapping"))?(c.set("mappingStatus","syncing"),b.push(c.get("mapping"))):(c.set("checked",!1),c.set("mappingStatus","complete"),c.fetch().done(function(){c.trigger("render")}))}),b.length?void this.checkStatus(b,a.data.direction):this.clearTimeout()},ajaxFail:function(a){console.warn("response",a),this.setSelectedMappingStatus("failed"),this.clearTimeout()},setSelectedMappingStatus:function(a){var b=this.getSelectedAndChecked();return _.each(b,function(b){b.set("mappingStatus",a)}),b},checkStatus:function(a,b){this.clearTimeout(),this.timeoutID=window.setTimeout(function(){e.doAjax({check:a},b)},1e3)},clearTimeout:function(){window.clearTimeout(this.timeoutID),this.timeoutID=null},doAjax:function(a,b){this.ajax.set("action","gc_"+b+"_items"),this.ajax.send(a,this.ajaxSuccess.bind(this),0,this.ajaxFail.bind(this))}})}},{"./../models/ajax.js":7}],15:[function(a,b,c){"use strict";b.exports=function(a,b){return a.views.base.extend({template:wp.template("gc-post-column-row"),tagName:"span",className:"gc-status-column",id:function(){return"gc-status-row-"+this.model.get("id")},initialize:function(){this.listenTo(this.model,"change:status",this.render)},html:function(){return this.template(this.model.toJSON())},render:function(){var a=b.$id("post-"+this.model.get("id")).find(".column-gathercontent");return a.html(this.html()),this}})}},{}],16:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d;return a.views.statusSelect2.extend({template:wp.template("gc-status-select2"),el:"#posts-filter tbody",width:"200px",events:{"change .gc-select2":"storeStatus"},initialize:function(){d=this,this.listenTo(this,"quickEdit",this.edit),this.render(),c.post(window.ajaxurl,{action:"gc_get_items",posts:b._posts,flush_cache:!!b.queryargs.flush_cache},function(a){a.success,a.data&&d.collection.trigger("updateItems",a.data)})},storeStatus:function(a){var b=jQuery(a.target),c=b.val(),d=this.collection.getById(b.data("id"));d.set("setStatus",c)},edit:function(a,e){var f=0;if("object"==typeof a&&(f=parseInt(e.getId(a),10)),this.waitSpinner(f),f){var g=this.collection.getById(f);return g.get("statusesChecked")?this.renderStatuses(g):void c.post(window.ajaxurl,{action:"gc_get_post_statuses",postId:f,flush_cache:!!b.queryargs.flush_cache},this.ajaxResponse).done(function(){d.renderStatuses(g)})}},ajaxResponse:function(a){if(a.data){var b=d.collection.getById(a.data.postId);b&&(b.set("statusesChecked",!0),a.success&&(b.set("statuses",a.data.statuses),b.get("statuses").length&&(d.$(".gc-select2").each(function(){c(this).select2("destroy")}),d.renderStatuses(b))))}},renderStatuses:function(a){var c=a.get("id");this.editSelect(c).html(this.template(a.toJSON())),a.get("statuses").length&&this.renderSelect2(b.$id("edit-"+c))},waitSpinner:function(a){this.editSelect(a).html('<span class="spinner"></span>')},editSelect:function(a){return b.$id("edit-"+a).find(".inline-edit-group .gc-status-select2")},render:function(){return this.collection.each(function(b){new a.views.postRow({model:b}).render()}),this}})}},{}],17:[function(a,b,c){"use strict";b.exports=function(a){var b;return a.views.base.extend({select2ItemTemplate:wp.template("gc-select2-item"),width:"250px",renderSelect2:function(a){var c=a?a.find(".gc-select2"):this.$(".gc-select2");return b=this,c.each(function(){var a=jQuery(this),c=a.data();a.select2(b.select2Args(c));var d=a.data("select2");d.$results.addClass("select2-"+c.column),d.$container.addClass("select2-"+c.column)}),this},select2Args:function(a){var c={width:b.width};return c.templateResult=function(a,c){var d=jQuery.extend(a,jQuery(a.element).data());return d.description=!1===c?!1:d.description||"",jQuery(b.select2ItemTemplate(a))}.bind(b),c.templateSelection=function(a){return c.templateResult(a,!1)},c}})}},{}]},{},[5]);