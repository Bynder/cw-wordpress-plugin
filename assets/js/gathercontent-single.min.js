/*! GatherContent Importer - v3.0.0 - 2016-07-13 | http://www.gathercontent.com | Copyright (c) 2016 GatherContent | Licensed GPLv2 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=Backbone.Collection.extend({getById:function(a){return this.find(function(b){var c=b.get("id");return c===a||c&&a&&c==a})}})},{}],2:[function(a,b,c){"use strict";b.exports=function(b){b.models={base:a("./models/base.js")},b.collections={base:a("./collections/base.js")},b.views={base:a("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":3,"./views/base.js":6}],3:[function(a,b,c){"use strict";b.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],4:[function(a,b,c){"use strict";b.exports=function(a){return Backbone.Model.extend({defaults:{id:0,item:0,itemName:0,updated:"",editLink:"",mapping:0,mappingName:0,mappingLink:"",mappingStatus:"",status:{},checked:!1,disabled:!1,statuses:[],statusesChecked:!1,statusSetting:{}},url:function(){return window.ajaxurl+"?action=gc_fetch_js_post&id="+this.get("id")},_get:function(b,c){switch(c){case"disabled":b=!this.get("item")||!this.get("mapping");break;case"mappingStatus":b=a._statuses[b]?a._statuses[b]:""}return b},get:function(a){return this._get(Backbone.Model.prototype.get.call(this,a),a)},toJSON:function(){return _.mapObject(Backbone.Model.prototype.toJSON.call(this),_.bind(this._get,this))}})}},{}],5:[function(a,b,c){"use strict";window.GatherContent=window.GatherContent||{},function(b,c,d,e,f){e.single=e.single||{};var g=e.single;a("./initiate-objects.js")(g),g.models.post=a("./models/post.js")(e),g.views.statusSelect2=a("./views/status-select2.js")(g),g.views.metabox=a("./views/metabox.js")(g,d,e),g.init=function(){g.metaboxView=new g.views.metabox({model:new g.models.post(e._post)})},d(g.init)}(window,document,jQuery,window.GatherContent)},{"./initiate-objects.js":2,"./models/post.js":4,"./views/metabox.js":8,"./views/status-select2.js":9}],6:[function(a,b,c){"use strict";b.exports=Backbone.View.extend({toggleExpanded:function(a){this.model.set("expanded",!this.model.get("expanded"))},getRenderedModels:function(a,b){b=b||this.collection;var c=document.createDocumentFragment();return b.each(function(b){var d=new a({model:b}).render();c.appendChild(d.el)}),c},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}})},{}],7:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d;return a.views.statusSelect2.extend({className:"misc-pub-section misc-pub-post-status",select2template:wp.template("gc-status-select2"),template:wp.template("gc-metabox-statuses"),isOpen:!1,initialize:function(){d=this,this.listenTo(this,"render",this.render),this.listenTo(this,"statusesOpen",this.statusesOpen),this.listenTo(this,"statusesClose",this.statusesClose)},statusesOpen:function(){this.isOpen=!0,this.model.get("statusesChecked")||this.asyncInit(),this.$(".edit-gc-status").addClass("hidden"),this.$("#gc-post-status-select").slideDown("fast")},statusesClose:function(){this.isOpen=!1,this.$(".edit-gc-status").removeClass("hidden"),this.$("#gc-post-status-select").slideUp("fast")},asyncInit:function(){b.post(window.ajaxurl,{action:"gc_get_post_statuses",postId:this.model.get("id"),flush_cache:!!c.queryargs.flush_cache},this.ajaxResponse.bind(this)).done(function(){d.renderStatuses()}).fail(function(){d.model.set("statusesChecked",!1)}),this.model.set("statusesChecked",!0)},ajaxResponse:function(a){return a.data&&a.success?(this.model.set("statusesChecked",!0),this.model.set("statuses",a.data.statuses),void(this.model.get("statuses").length&&(d.$(".gc-select2").each(function(){b(this).select2("destroy")}),d.renderStatuses()))):void this.model.set("statusesChecked",!1)},renderStatuses:function(){this.model.get("id");this.$("#gc-status-selec2").html(this.select2template(this.model.toJSON())),this.model.get("statuses").length&&this.renderSelect2(this.$el)}})}},{}],8:[function(a,b,c){"use strict";b.exports=function(b,c,d){var e,f=a("./../views/metabox-statuses.js")(b,c,d);return b.views.base.extend({el:"#gc-related-data",template:wp.template("gc-metabox"),statusesView:null,events:{"click .edit-gc-status":"editStatus","click .cancel-gc-status":"cancelEditStatus","click .save-gc-status":"saveStatus","click #gc-pull":"pull","click #gc-push":"push"},initialize:function(){e=this,this.listenTo(this.model,"change:status",this.renderStatusView),this.render(),this.$el.removeClass("no-js"),this.refreshData()},refreshData:function(){console.log("refreshData"),this.ajax({action:"gc_get_items",posts:[e.model.toJSON()]},function(a){a.success&&a.data&&!e.statusesView.isOpen&&this.updateModel(a.data)})},updateModel:function(a){var b=this.model.get("id");b in a&&(a[b].status&&this.model.set("status",a[b].status),a[b].itemName&&this.model.set("itemName",a[b].itemName),a[b].updated&&this.model.set("updated",a[b].updated))},editStatus:function(a){a.preventDefault(),this.statusesView.trigger("statusesOpen")},cancelEditStatus:function(a){a.preventDefault(),this.statusesView.trigger("statusesClose")},saveStatus:function(){var a,b,c,d,f=this.$(".gc-default-mapping-select").val(),g=this.model.get("status"),h=g&&g.id?g.id:!1;return f===h?this.statusesView.trigger("statusesClose"):(b=this.model.get("statuses"),a=_.find(b,function(a){return parseInt(f,10)===parseInt(a.id,10)}),this.statusesView.trigger("statusesClose"),this.model.set("status",a),c=function(){e.model.set("status",g)},d=function(a){console.warn("set_gc_status response",a),a.success?this.refreshData():c()},void this.ajax({action:"set_gc_status",status:f},d).fail(c))},pull:function(){this.doSync("pull")},push:function(){this.doSync("push")},doSync:function(a){if(window.confirm(d._sure[a])){this.$(".gc-publishing-action .spinner").addClass("is-active");var b=function(a){a=a||d._errors.unknown,window.alert(a)},c=function(c){console.warn("do "+a+" response",c),this.$(".gc-publishing-action .spinner").removeClass("is-active"),c.success?this.refreshData():b(c.data)};this.ajax({action:"gc_do_"+a},c).fail(function(){b()})}},ajax:function(a,b){return c.post(window.ajaxurl,c.extend({action:"",post:this.model.toJSON(),nonce:d.$id("gc-edit-nonce").val(),flush_cache:!!d.queryargs.flush_cache},a),b.bind(this))},initStatusView:function(){this.statusesView&&this.statusesView.close(),this.statusesView=new f({model:this.model})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.initStatusView(),this.$(".misc-pub-section.gc-item-name").after(this.statusesView.render().el),this},renderStatusView:function(){this.statusesView.$el.replaceWith(this.statusesView.render().el)}})}},{"./../views/metabox-statuses.js":7}],9:[function(a,b,c){"use strict";b.exports=function(a){var b;return a.views.base.extend({select2ItemTemplate:wp.template("gc-select2-item"),width:"250px",renderSelect2:function(a){var c=a?a.find(".gc-select2"):this.$(".gc-select2");return b=this,c.each(function(){var a=jQuery(this),c=a.data();a.select2(b.select2Args(c));var d=a.data("select2");d.$results.addClass("select2-"+c.column),d.$container.addClass("select2-"+c.column)}),this},select2Args:function(a){var c={width:b.width};return c.templateResult=function(a,c){var d=jQuery.extend(a,jQuery(a.element).data());return d.description=!1===c?!1:d.description||"",jQuery(b.select2ItemTemplate(a))}.bind(b),c.templateSelection=function(a){return c.templateResult(a,!1)},c}})}},{}]},{},[5]);