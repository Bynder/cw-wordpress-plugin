/*! GatherContent Importer - v3.0.0 - 2016-07-07 | http://www.gathercontent.com | Copyright (c) 2016 GatherContent | Licensed GPLv2 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=Backbone.Collection.extend({getById:function(a){return this.find(function(b){var c=b.get("id");return c===a||c&&a&&c==a})}})},{}],2:[function(a,b,c){"use strict";b.exports=function(a){return a.collections.base.extend({model:a.models.item,totalChecked:0,allChecked:!1,syncEnabled:!1,initialize:function(){this.listenTo(this,"checkAll",this.toggleChecked),this.listenTo(this,"change:checked",this.checkChecked)},checkChecked:function(a){var b=!1;a.changed.checked?this.totalChecked++:(this.totalChecked===this.length&&(this.allChecked=!1,b=!0),this.totalChecked--);var c=this.syncEnabled;this.syncEnabled=this.totalChecked>0,c!==this.syncEnabled&&this.trigger("enabledChange",this.syncEnabled),this.totalChecked<this.length&&this.trigger("notAllChecked",!1)},toggleChecked:function(a){this.allChecked=a,this.each(function(b){b.set("checked",!!a)}),this.trigger("render")}})}},{}],3:[function(a,b,c){"use strict";b.exports=function(b){b.models={base:a("./models/base.js")},b.collections={base:a("./collections/base.js")},b.views={base:a("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":5,"./views/base.js":8}],4:[function(a,b,c){"use strict";b.exports=function(a,b){return b=jQuery.extend({},{action:"gc_sync_items",data:"",percent:0,nonce:"",id:"",stopSync:!0,flush_cache:!1},b),a.models.base.extend({defaults:b,initialize:function(){this.listenTo(this,"send",this.send)},reset:function(){return this.clear().set(this.defaults),this},send:function(a,b,c,d){return c&&this.set("percent",c),jQuery.post(window.ajaxurl,{action:this.get("action"),percent:this.get("percent"),nonce:this.get("nonce"),id:this.get("id"),data:a,flush_cache:this.get("flush_cache")},function(c){return this.trigger("response",c,a),c.success?b(c):d?d(c):void 0}.bind(this)),this}})}},{}],5:[function(a,b,c){"use strict";b.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],6:[function(a,b,c){"use strict";b.exports=function(a){return a.models.base.extend({defaults:{id:0,project_id:0,parent_id:0,template_id:0,custom_state_id:0,position:0,name:"",config:"",notes:"",type:"",overdue:!1,archived_by:"",archived_at:"",created_at:null,updated_at:null,status:null,due_dates:null,expanded:!1,checked:!1}})}},{}],7:[function(a,b,c){"use strict";window.GatherContent=window.GatherContent||{},function(b,c,d,e,f){e.sync=e.sync||{};var g=e.sync;a("./initiate-objects.js")(g),g.models.item=a("./models/item.js")(g),g.collections.items=a("./collections/items.js")(g),g.views.item=a("./views/item.js")(g),g.views.items=a("./views/items.js")(g,d,e),g.init=function(){g.syncView=new g.views.items({collection:new g.collections.items(e._items)})},d(g.init)}(window,document,jQuery,window.GatherContent)},{"./collections/items.js":2,"./initiate-objects.js":3,"./models/item.js":6,"./views/item.js":9,"./views/items.js":10}],8:[function(a,b,c){"use strict";b.exports=Backbone.View.extend({toggleExpanded:function(a){this.model.set("expanded",!this.model.get("expanded"))},getRenderedModels:function(a,b){b=b||this.collection;var c=document.createDocumentFragment();return b.each(function(b){var d=new a({model:b}).render();c.appendChild(d.el)}),c},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})},{}],9:[function(a,b,c){"use strict";b.exports=function(a){return a.views.base.extend({template:wp.template("gc-item"),tagName:"tr",className:"gc-item",id:function(){return this.model.get("id")},events:{"change .check-column input":"toggleCheck","click .gc-reveal-items":"toggleExpanded"},initialize:function(){this.listenTo(this.model,"change:checked",this.render)},toggleCheck:function(){this.model.set("checked",!this.model.get("checked"))}})}},{}],10:[function(a,b,c){"use strict";b.exports=function(b,c,d){var e,f=d.percent,g=d.log,h=".gc-field-th.check-column input";return b.views.base.extend({el:"#sync-tabs",template:wp.template("gc-items-sync"),progressTemplate:wp.template("gc-items-sync-progress"),spinnerRow:'<tr><td colspan="3"><span class="gc-loader spinner is-active"></span></td></tr>',$wrap:c(".gc-admin-wrap"),intervalID:null,ajax:null,events:function(){var a={"click .gc-cancel-sync":"clickCancelSync"};return a["change "+h]="checkAll",a},initialize:function(){e=this,this.setupAjax(),this.listenTo(this.ajax,"response",this.ajaxResponse),this.listenTo(this.collection,"render",this.render),this.listenTo(this.collection,"enabledChange",this.checkEnableButton),this.listenTo(this.collection,"notAllChecked",this.allCheckedStatus),this.listenTo(this,"render",this.render),this.$wrap.on("submit","form",this.submit.bind(this)),this.initRender()},setupAjax:function(){var c=a("./../models/ajax.js")(b,{checkHits:0,time:500,nonce:d.el("_wpnonce").value,id:d.el("gc-input-mapping_id").value,flush_cache:!!d.queryargs.flush_cache});this.ajax=new c({percent:f})},checkEnableButton:function(a){this.buttonStatus(a)},buttonStatus:function(a){this.$wrap.find(".button-primary").prop("disabled",!a)},allCheckedStatus:function(a){this.$wrap.find(h).prop("checked",a)},checkAll:function(a){this.collection.trigger("checkAll",c(a.target).is(":checked"))},clickCancelSync:function(a){a.preventDefault(),this.cancelSync()},doSpinner:function(){this.$el.find("tbody").html(this.spinnerRow)},submit:function(a){a.preventDefault(),this.startSync(this.$wrap.find("form").serialize())},startSync:function(a){this.doSpinner(),this.ajax.reset().set("stopSync",!1),this.renderProgress(100===window.parseInt(f,10)?0:f),this.doAjax(a,f)},cancelSync:function(a){console.warn("cancelSync"),f=null,this.ajax.reset(),this.clearInterval(),a?this.doAjax("cancel",0,function(){window.location.href=a}):(this.doAjax("cancel",0,function(){}),this.initRender())},doAjax:function(a,b,c){c=c||this.ajaxSuccess.bind(this),this.ajax.send(a,c,b)},ajaxSuccess:function(a){if(!this.ajax.get("stopSync")){f=a.data.percent||1;var b=this.checkHits(),c=this.ajax.get("time");b>25&&2e3>c?(this.clearInterval(),this.ajax.set("time",2e3)):b>50&&5e3>c&&(this.clearInterval(),this.ajax.set("time",5e3)),this.setInterval(this.checkProgress.bind(this)),f>99?this.cancelSync(window.location.href+"&updated=1&flush_cache=1&redirect=1"):this.renderProgressUpdate(f)}},setInterval:function(a){this.intervalID=this.intervalID||window.setInterval(a,this.ajax.get("time"))},clearInterval:function(){window.clearInterval(this.intervalID),this.intervalID=null},checkProgress:function(){console.log("checkProgress "+this.checkHits()+" "+this.ajax.get("time")),this.doAjax("check",f)},checkHits:function(){return window.parseInt(this.ajax.get("checkHits"),10)},ajaxResponse:function(a,b){g("warn","response",a),"check"===b?this.ajax.set("checkHits",this.checkHits()+1):this.ajax.set("checkHits",0),a.success||(this.renderProgressUpdate(0),a.data&&window.alert(a.data),this.cancelSync())},renderProgressUpdate:function(a){this.$(".gc-progress-bar-partial").css({width:a+"%"}).find("span").text(a+"%")},renderProgress:function(a){this.$wrap.addClass("gc-sync-progress"),this.buttonStatus(!1),this.$el.html(this.progressTemplate({percent:a}))},initRender:function(){f>0&&100>f?this.startSync("check"):(this.$el.html(this.template({checked:this.collection.allChecked})),this.render())},render:function(){return this.$wrap.removeClass("gc-sync-progress"),this.$el.find("tbody").html(this.getRenderedModels(b.views.item)),this.buttonStatus(this.collection.syncEnabled),this.allCheckedStatus(this.collection.allChecked),this}})}},{"./../models/ajax.js":4}]},{},[7]);