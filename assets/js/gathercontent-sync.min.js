/*! GatherContent Importer - v3.0.0 - 2016-06-22 | http://www.gathercontent.com | Copyright (c) 2016 GatherContent | Licensed GPLv2 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=Backbone.Collection.extend({getById:function(a){return this.find(function(b){return b.get("id")===a})}})},{}],2:[function(a,b,c){"use strict";b.exports=function(a){return a.collections.base.extend({model:a.models.item,initialize:function(){this.listenTo(this,"checkAll",this.toggleChecked)},toggleChecked:function(a){this.each(function(b){b.set("checked",!!a)})}})}},{}],3:[function(a,b,c){"use strict";b.exports=function(b){b.models={base:a("./models/base.js")},b.collections={base:a("./collections/base.js")},b.views={base:a("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":4,"./views/base.js":7}],4:[function(a,b,c){"use strict";b.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],5:[function(a,b,c){"use strict";b.exports=function(a){return a.models.base.extend({defaults:{id:0,project_id:0,parent_id:0,template_id:0,custom_state_id:0,position:0,name:"",config:"",notes:"",type:"",overdue:!1,archived_by:"",archived_at:"",created_at:null,updated_at:null,status:null,due_dates:null,expanded:!1,checked:!1}})}},{}],6:[function(a,b,c){"use strict";window.GatherContent=window.GatherContent||{},function(b,c,d,e,f){e.sync=e.sync||{};var g=e.sync;a("./initiate-objects.js")(g),g.models.item=a("./models/item.js")(g),g.collections.items=a("./collections/items.js")(g),g.views.item=a("./views/item.js")(g),g.views.items=a("./views/items.js")(g,d,e.percent),g.init=function(){g.syncView=new g.views.items({collection:new g.collections.items(e._items)})},d(g.init)}(window,document,jQuery,window.GatherContent)},{"./collections/items.js":2,"./initiate-objects.js":3,"./models/item.js":5,"./views/item.js":8,"./views/items.js":9}],7:[function(a,b,c){"use strict";b.exports=Backbone.View.extend({toggleExpanded:function(a){this.model.set("expanded",!this.model.get("expanded"))},getRenderedItems:function(a,b){b=b||this.collection;var c=document.createDocumentFragment();return b.each(function(b){var d=new a({model:b}).render();c.appendChild(d.el)}),c},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})},{}],8:[function(a,b,c){"use strict";b.exports=function(a){return a.views.base.extend({template:wp.template("gc-item"),tagName:"tr",className:"gc-item",id:function(){return this.model.get("id")},events:{"change .check-column input":"toggleCheck","click .gc-reveal-items":"toggleExpanded"},initialize:function(){this.listenTo(this.model,"change:checked",this.render)},toggleCheck:function(){this.model.set("checked",!this.model.get("checked"))},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}},{}],9:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d;return a.views.base.extend({el:"#sync-tabs",template:wp.template("gc-items-sync"),progressTemplate:wp.template("gc-items-sync-progress"),spinnerRow:'<tr><td colspan="3"><span class="gc-loader spinner is-active"></span></td></tr>',$wrap:b(".gc-admin-wrap"),intervalID:null,hits:0,time:500,stopSync:!1,events:{"change th.check-column input":"checkAll","click .gc-cancel-sync":"clickCancelSync"},checkAll:function(a){this.collection.trigger("checkAll",b(a.target).is(":checked"))},clickCancelSync:function(a){a.preventDefault(),this.cancelSync()},cancelSync:function(a){console.warn("cancelSync"),c=null,this.stopSync=!0,this.hits=0,this.time=500,this.clearInterval(),a?window.location.href=a:this.initRender()},initialize:function(){d=this,this.listenTo(this.collection,"render",this.render),this.listenTo(this,"render",this.render),this.$wrap.on("submit","form",this.submit.bind(this)),this.initRender()},doSpinner:function(){this.$el.find("tbody").html(this.spinnerRow)},submit:function(a){a.preventDefault(),this.startSync(this.$wrap.find("form").serialize())},startSync:function(a){this.doSpinner(),this.stopSync=!1,this.renderProgress(c),this.ajaxPost(a,c)},ajaxPost:function(a,c){b.post(window.ajaxurl,{action:"gc_sync_items",data:a,percent:c},this.ajaxResponse.bind(this))},ajaxResponse:function(a){this.hits++,this.stopSync||a.success&&(c=a.data.percent||1,this.hits>25&&this.time<2e3?(this.clearInterval(),this.time=2e3):this.hits>50&&this.time<5e3&&(this.clearInterval(),this.time=5e3),this.setInterval(this.checkProgress.bind(this)),c>99?this.cancelSync(window.location.href+"&updated=1"):this.renderProgressUpdate(c))},setInterval:function(a){this.intervalID=this.intervalID||window.setInterval(a,this.time)},clearInterval:function(){window.clearInterval(this.intervalID),this.intervalID=null},checkProgress:function(){console.log("checkProgress "+this.hits+" "+this.time),this.ajaxPost("check",c)},renderProgressUpdate:function(a){this.$(".gc-progress-bar-partial").css({width:a+"%"}).find("span").text(a+"%")},renderProgress:function(a){this.$wrap.addClass("sync-progress"),this.$wrap.find(".button-primary").prop("disabled",!0),this.$el.html(this.progressTemplate({percent:a}))},initRender:function(){c>0&&100>c?this.startSync("check"):(this.$wrap.removeClass("sync-progress"),this.$wrap.find(".button-primary").prop("disabled",!1),this.$el.html(this.template()),this.render())},render:function(){var b=this.getRenderedItems(a.views.item);return this.$el.find("tbody").html(b),this}})}},{}]},{},[6]);